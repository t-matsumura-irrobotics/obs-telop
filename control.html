<!-- control.html (変更なし・確認用) -->
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>OBS Telop Controller</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f0f0f0; padding-bottom: 400px; }
        .wrapper { max-width: 800px; margin: 0 auto 20px auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h1, h3 { text-align: center; color: #333; }
        h3 { margin-top: 30px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .control-group { margin-bottom: 15px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 120px; gap: 10px; align-items: flex-end;}
        .draft-controls { display: grid; grid-template-columns: 1fr auto auto auto; gap: 10px; align-items: flex-end; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; box-sizing: border-box; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 4px; }
        textarea { height: 80px; resize: vertical; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; border-radius: 4px; border: none; }
        .show-btn { background-color: #28a745; color: white; }
        .hide-btn { background-color: #ffc107; color: black; }
        .draft-btn { background-color: #007bff; color: white; }
        .delete-btn { background-color: #6c757d; color: white; }
        .char-counter { text-align: right; font-size: 12px; color: #666; margin-top: -10px; margin-bottom: 15px; }
    </style>
</head>
<body>
    <div class="wrapper">
        <h1>ライブテロップ コントローラー</h1>
        <h3>通常ティッカー</h3>
        <div class="control-group">
            <label for="tickerHeaderText">ヘッダーテキスト</label>
            <input type="text" id="tickerHeaderText" value="東京株式市場">
        </div>
        <div class="control-group">
            <label for="tickerScrollText">スクロールテキスト</label>
            <textarea id="tickerScrollText">質問や応援コメントお待ちしています。／日経平均株価は前日比プラスで推移しています。</textarea>
        </div>
        <button id="tickerSendButton" class="show-btn" style="width:100%;">ティッカー表示を更新</button>
    </div>

    <div class="wrapper">
        <h3>決算速報</h3>
        <div class="control-group"><label for="themeColor">テーマ色</label><select id="themeColor"><option value="theme-yellow">黄色</option><option value="theme-red">赤色</option></select></div>
        <div class="control-group"><label for="headerText">ヘッダー (白背景)</label><input type="text" id="headerText" value="決算速報"></div>
        <div class="control-group"><label for="companyName">企業名</label><input type="text" id="companyName" value="東証プライム【7203】トヨタ自動車"></div>
        <div class="control-group grid-2">
            <div><label for="detailText">テキスト</label><input type="text" id="detailText" value="2026年3月期 第3四半期 増収増益で着地" maxlength="30"></div>
            <div><label for="detailColor">文字色</label><select id="detailColor"><option value="text-black">黒</option><option value="text-red">赤</option><option value="text-blue">青</option></select></div>
        </div>
        <div class="char-counter"><span id="char-count">0</span> / 30</div>
        <div style="display: flex; gap: 10px;">
            <button id="breakingSendButton" class="show-btn" style="flex-grow: 1;">速報表示</button>
            <button id="hideButton" class="hide-btn">ティッカーに戻る</button>
        </div>
        <h3 style="margin-top: 40px;">下書き（速報用）</h3>
        <div class="draft-controls">
            <div class="control-group"><label for="drafts">保存済みテロップ</label><select id="drafts"></select></div>
            <button id="loadDraftButton" class="draft-btn">読込</button>
            <button id="saveDraftButton" class="draft-btn">保存</button>
            <button id="deleteDraftButton" class="delete-btn">削除</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        const firebaseConfig = { apiKey: "AIzaSyAhsAbTqQuairo-82A9rxQTazUCGdzdVc4", authDomain: "obs-telop-system-7c98c.firebaseapp.com", databaseURL: "https://obs-telop-system-7c98c-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "obs-telop-system-7c98c", storageBucket: "obs-telop-system-7c98c.appspot.com", messagingSenderId: "368503557333", appId: "1:368503557333:web:409dae2b1cf0c14b31a65c", measurementId: "G-VMBCJ2952Z" };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const liveDataRef = database.ref('live_data');
        const DRAFT_KEY = 'obs-telop-drafts';
        const breakingControlIDs = ['themeColor', 'headerText', 'companyName', 'detailText', 'detailColor'];

        document.getElementById('tickerSendButton').addEventListener('click', () => {
            liveDataRef.set({
                mode: 'ticker',
                ticker_content: {
                    headerText: document.getElementById('tickerHeaderText').value,
                    scrollText: document.getElementById('tickerScrollText').value,
                }
            });
            alert('ティッカーを更新しました。');
        });

        document.getElementById('breakingSendButton').addEventListener('click', () => {
            const breaking_content = {};
            breakingControlIDs.forEach(id => breaking_content[id] = document.getElementById(id).value);
            liveDataRef.set({ mode: 'breaking', breaking_content });
            alert('速報を送信しました！');
        });
        
        document.getElementById('hideButton').addEventListener('click', () => {
            liveDataRef.update({ mode: 'ticker' });
            alert('ティッカー表示に戻します。');
        });

        const detailTextInput = document.getElementById('detailText'), charCountSpan = document.getElementById('char-count');
        function updateCharCount() { charCountSpan.textContent = detailTextInput.value.length; }
        detailTextInput.addEventListener('input', updateCharCount);

        function getDrafts() { return JSON.parse(localStorage.getItem(DRAFT_KEY) || '{}'); }
        function saveDrafts(drafts) { localStorage.setItem(DRAFT_KEY, JSON.stringify(drafts)); }
        function updateDraftList() {
            const drafts = getDrafts(); const draftSelect = document.getElementById('drafts'); draftSelect.innerHTML = '';
            for (const name in drafts) { const option = document.createElement('option'); option.value = name; option.textContent = name; draftSelect.appendChild(option); }
        }
        document.getElementById('saveDraftButton').addEventListener('click', () => {
            const name = prompt('下書きの名前を入力してください:'); if (!name) return;
            const drafts = getDrafts(); drafts[name] = {};
            breakingControlIDs.forEach(id => drafts[name][id] = document.getElementById(id).value);
            saveDrafts(drafts); updateDraftList(); alert(`「${name}」として保存しました。`);
        });
        document.getElementById('loadDraftButton').addEventListener('click', () => {
            const name = document.getElementById('drafts').value; if (!name) return alert('下書きを選択してください。');
            const draftData = getDrafts()[name];
            breakingControlIDs.forEach(id => document.getElementById(id).value = draftData[id]);
            updateCharCount(); alert(`「${name}」を読み込みました。`);
        });
        document.getElementById('deleteDraftButton').addEventListener('click', () => {
            const name = document.getElementById('drafts').value; if (!name) return alert('下書きを選択してください。');
            if (!confirm(`「${name}」を削除しますか？`)) return;
            const drafts = getDrafts(); delete drafts[name];
            saveDrafts(drafts); updateDraftList(); alert(`「${name}」を削除しました。`);
        });

        document.addEventListener('DOMContentLoaded', () => { updateCharCount(); updateDraftList(); });
    </script>
</body>
</html>