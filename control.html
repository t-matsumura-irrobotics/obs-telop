<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Live Telop Controller (Debug Mode)</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>ãƒ©ã‚¤ãƒ–ãƒ†ãƒ­ãƒƒãƒ— ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ (ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰)</h1>
    <div class="main-grid">
        <div id="on-air-panel" class="panel">
            <h2>ON AIR (ç¾åœ¨ã®è¡¨ç¤ºå†…å®¹)</h2>
            <div id="on-air-status">OFFLINE</div>
        </div>
        <div id="preview-panel" class="panel">
            <h2>PREVIEW / EDIT</h2>
            <div class="tabs">
                <button id="tab-ticker" class="tab-button active">é€šå¸¸ãƒ†ã‚£ãƒƒã‚«ãƒ¼</button>
                <button id="tab-breaking" class="tab-button">ç·Šæ€¥é€Ÿå ±</button>
            </div>

            <div id="ticker-controls" class="tab-content active">
                <label>ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆ</label>
                <input type="text" id="tickerHeaderText" value="æ±äº¬æ ªå¼å¸‚å ´">
                
                <label>ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é€Ÿåº¦</label>
                <select id="tickerScrollSpeed">
                    <option value="speed-slow">é…ã„</option>
                    <option value="speed-normal" selected>æ™®é€š</option>
                    <option value="speed-fast">é€Ÿã„</option>
                </select>
                
                <label>ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ†ã‚­ã‚¹ãƒˆ</label>
                <textarea id="tickerScrollText">è³ªå•ã‚„å¿œæ´ã‚³ãƒ¡ãƒ³ãƒˆãŠå¾…ã¡ã—ã¦ã„ã¾ã™ã€‚</textarea>
                
                <div style="margin-top: 15px;">
                    <input type="checkbox" id="isLiveCheckbox">
                    <label for="isLiveCheckbox" style="display: inline-block;">ãƒ†ã‚£ãƒƒã‚«ãƒ¼ã«LIVEè¡¨ç¤º</label>
                </div>
            </div>

            <div id="breaking-controls" class="tab-content">
                <div class="breaking-grid">
                    <div class="grid-item full-width">
                        <label>é€Ÿå ±ãƒ˜ãƒƒãƒ€ãƒ¼</label>
                        <input type="text" id="br-r1-h-input" value="é€Ÿå ±">
                    </div>
                    <div class="grid-item full-width">
                        <label>é€Ÿå ±ãƒ¡ã‚¤ãƒ³</label>
                        <input type="text" id="br-r1-m-input" value="é–¢æ±åœ°æ–¹ã§å¼·ã„æºã‚Œ">
                    </div>
                    <div class="grid-item">
                        <label>æƒ…å ±1</label>
                        <input type="text" id="br-r2-i1-input" value="éœ‡æºåœ°: æ±äº¬æ¹¾">
                    </div>
                    <div class="grid-item">
                        <label>æƒ…å ±2</label>
                        <input type="text" id="br-r2-i2-input" value="æœ€å¤§éœ‡åº¦: 5å¼·">
                    </div>
                    <div class="grid-item">
                        <label>æƒ…å ±3</label>
                        <input type="text" id="br-r2-i3-input" value="M: 7.1">
                    </div>
                    <div class="grid-item">
                        <label>æƒ…å ±4</label>
                        <input type="text" id="br-r2-i4-input" value="æ´¥æ³¢ã®å¿ƒé…ãªã—">
                    </div>
                    <div class="grid-item full-width">
                        <label>è£œè¶³ãƒ˜ãƒƒãƒ€ãƒ¼</label>
                        <input type="text" id="br-r3-h-input" value="[ä»Šå¾Œã®æƒ…å ±]">
                    </div>
                    <div class="grid-item full-width">
                        <label>è£œè¶³ãƒ¡ã‚¤ãƒ³</label>
                        <input type="text" id="br-r3-m-input" value="ãƒ†ãƒ¬ãƒ“ãƒ»ãƒ©ã‚¸ã‚ªã®æƒ…å ±ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚">
                    </div>
                </div>
            </div>
            <div class="button-group">
                <button id="takeButton" class="btn btn-take">TAKE</button>
                <button id="fallbackButton" class="btn btn-fallback">FALLBACK (TICKER)</button>
                <button id="toggleClockButton" class="btn btn-clock-toggle">æ™‚å ± ON/OFF</button>
            </div>
        </div>
        <div id="shots-panel" class="panel">
             <h2>SAVED SHOTS (é€Ÿå ±ç”¨)</h2>
             <ul id="shots-list"></ul>
             <div class="save-shot">
                <input type="text" id="shot-name-input" placeholder="ä¸‹æ›¸ãã®åå‰...">
                <button id="save-shot-button" class="btn-save">ä¿å­˜</button>
             </div>
        </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        // â–¼â–¼â–¼ ã“ã“ã‹ã‚‰ãƒ‡ãƒãƒƒã‚°ç”¨ã®ã‚³ãƒ¼ãƒ‰ã§ã™ â–¼â–¼â–¼
        console.log("å¤©ä½¿ã®ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ï¼šã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’é–‹å§‹ã—ã¾ã™ğŸ‘¼");

        const firebaseConfig = {
            apiKey: "AIzaSyAhsAbTqQuairo-82A9rxQTazUCGdzdVc4",
            authDomain: "obs-telop-system-7c98c.firebaseapp.com",
            databaseURL: "https://obs-telop-system-7c98c-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "obs-telop-system-7c98c",
            storageBucket: "obs-telop-system-7c98c.appspot.com",
            messagingSenderId: "368503557333",
            appId: "1:368503557333:web:409dae2b1cf0c14b31a65c",
            measurementId: "G-VMBCJ2952Z"
        };
        
        try {
            firebase.initializeApp(firebaseConfig);
            console.log("å¤©ä½¿ã®ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ï¼šFirebaseã®åˆæœŸåŒ–ã«æˆåŠŸã—ã¾ã—ãŸï¼");
        } catch (e) {
            console.error("å¤©ä½¿ã®ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ï¼šFirebaseã®åˆæœŸåŒ–ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼", e);
        }
        
        const database = firebase.database();

        // UIè¦ç´ ã®å–å¾—
        const takeButton = document.getElementById('takeButton');
        const fallbackButton = document.getElementById('fallbackButton');
        const toggleClockButton = document.getElementById('toggleClockButton');
        
        // TAKEãƒœã‚¿ãƒ³ã®æ©Ÿèƒ½
        takeButton.addEventListener('click', () => {
            console.log("å¤©ä½¿ã®ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ï¼šTAKEãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸï¼");
            let liveData = { /* ... */ }; // (ãƒ‡ãƒ¼ã‚¿ä½œæˆãƒ­ã‚¸ãƒƒã‚¯ã¯çœç•¥)
            // ...
            console.log("å¤©ä½¿ã®ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ï¼šFirebaseã«ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã—ã¾ã™ ->", liveData);
            database.ref('live_data').set(liveData)
                .then(() => console.log("å¤©ä½¿ã®ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ï¼šãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡ã«æˆåŠŸã—ã¾ã—ãŸï¼âœ¨"))
                .catch((error) => console.error("å¤©ä½¿ã®ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ï¼šãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸï¼", error));
        });
        
        // æ™‚å ±è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã®æ©Ÿèƒ½
        toggleClockButton.addEventListener('click', () => {
            console.log("å¤©ä½¿ã®ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ï¼šæ™‚å ± ON/OFF ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸï¼");
            const newStatus = !currentShowClockStatus;
            console.log(`å¤©ä½¿ã®ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ï¼šæ™‚å ±ã®çŠ¶æ…‹ã‚’ ${newStatus} ã«å¤‰æ›´ã—ã¦é€ä¿¡ã—ã¾ã™ã€‚`);
            database.ref('live_data/showClock').set(newStatus)
                .then(() => console.log("å¤©ä½¿ã®ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ï¼šæ™‚å ±ã®çŠ¶æ…‹ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼"))
                .catch((error) => console.error("å¤©ä½¿ã®ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ï¼šæ™‚å ±ã®çŠ¶æ…‹é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸï¼", error));
        });
        
        // (ä»–ã®ã‚³ãƒ¼ãƒ‰ã¯çœç•¥)
        // â–²â–²â–² ã“ã“ã¾ã§ãƒ‡ãƒãƒƒã‚°ç”¨ã®ã‚³ãƒ¼ãƒ‰ã§ã™ â–²â–²â–²

        // (å…ƒã®JavaScriptã‚³ãƒ¼ãƒ‰ã¯ã“ã“ã«ç¶šãã¾ã™)
        const tabTicker = document.getElementById('tab-ticker');
        const tabBreaking = document.getElementById('tab-breaking');
        const tickerControls = document.getElementById('ticker-controls');
        const breakingControls = document.getElementById('breaking-controls');
        const isLiveCheckbox = document.getElementById('isLiveCheckbox');

        let currentShowClockStatus = false;
        database.ref('live_data/showClock').on('value', (snapshot) => {
            currentShowClockStatus = snapshot.val() || false;
            toggleClockButton.textContent = currentShowClockStatus ? 'æ™‚å ± OFF' : 'æ™‚å ± ON';
            toggleClockButton.classList.toggle('active', currentShowClockStatus);
        });

        tabTicker.addEventListener('click', () => {
            tabTicker.classList.add('active');
            tabBreaking.classList.remove('active');
            tickerControls.classList.add('active');
            breakingControls.classList.remove('active');
        });

        tabBreaking.addEventListener('click', () => {
            tabBreaking.classList.add('active');
            tabTicker.classList.remove('active');
            breakingControls.classList.add('active');
            tickerControls.classList.remove('active');
        });

        takeButton.addEventListener('click', () => {
            let liveData = { showClock: currentShowClockStatus };
            if (tabTicker.classList.contains('active')) {
                liveData.mode = 'ticker';
                liveData.ticker_content = {
                    headerText: document.getElementById('tickerHeaderText').value,
                    scrollText: document.getElementById('tickerScrollText').value,
                    scrollSpeed: document.getElementById('tickerScrollSpeed').value,
                    isLive: isLiveCheckbox.checked
                };
            } else {
                liveData.mode = 'breaking';
                liveData.breaking_content = {
                    b_r1_h: document.getElementById('br-r1-h-input').value,
                    b_r1_m: document.getElementById('br-r1-m-input').value,
                    b_r2_i1: document.getElementById('br-r2-i1-input').value,
                    b_r2_i2: document.getElementById('br-r2-i2-input').value,
                    b_r2_i3: document.getElementById('br-r2-i3-input').value,
                    b_r2_i4: document.getElementById('br-r2-i4-input').value,
                    b_r3_h: document.getElementById('br-r3-h-input').value,
                    b_r3_m: document.getElementById('br-r3-m-input').value,
                };
            }
            database.ref('live_data').set(liveData);
        });
        
        fallbackButton.addEventListener('click', () => {
             const liveData = {
                mode: 'ticker',
                ticker_content: {
                    headerText: document.getElementById('tickerHeaderText').value,
                    scrollText: document.getElementById('tickerScrollText').value,
                    scrollSpeed: document.getElementById('tickerScrollSpeed').value,
                    isLive: isLiveCheckbox.checked
                },
                showClock: currentShowClockStatus
            };
            database.ref('live_data').set(liveData);
        });

        toggleClockButton.addEventListener('click', () => {
            currentShowClockStatus = !currentShowClockStatus;
            database.ref('live_data/showClock').set(currentShowClockStatus);
        });

        const onAirStatus = document.getElementById('on-air-status');
        database.ref('live_data').on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                let displayHtml = '';
                if (data.mode === 'ticker') {
                    displayHtml = `<b>ç¾åœ¨: é€šå¸¸ãƒ†ã‚£ãƒƒã‚«ãƒ¼</b><br>ãƒ˜ãƒƒãƒ€ãƒ¼: ${data.ticker_content.headerText}<br>ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«: ${data.ticker_content.scrollText}<br>LIVEè¡¨ç¤º: ${data.ticker_content.isLive ? 'ON' : 'OFF'}`;
                } else if (data.mode === 'breaking') {
                    const b = data.breaking_content;
                    displayHtml = `<b>ç¾åœ¨: ç·Šæ€¥é€Ÿå ±</b><br>ãƒ˜ãƒƒãƒ€ãƒ¼: ${b.b_r1_h} - ${b.b_r1_m}`;
                }
                displayHtml += `<br>æ™‚å ±: ${data.showClock ? 'ON' : 'OFF'}`;
                onAirStatus.innerHTML = displayHtml;
            } else {
                onAirStatus.innerHTML = '<b>OFFLINE</b><br>ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“';
            }
        });
        
        // (ä¸‹æ›¸ãä¿å­˜æ©Ÿèƒ½ã®ã‚³ãƒ¼ãƒ‰ã¯çœç•¥)
        const saveShotButton = document.getElementById('save-shot-button');
        const shotNameInput = document.getElementById('shot-name-input');
        const shotsList = document.getElementById('shots-list');

        saveShotButton.addEventListener('click', () => {
            const shotName = shotNameInput.value.trim();
            if (!shotName) { alert('ä¸‹æ›¸ãã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'); return; }
            const shotData = { name: shotName, content: { b_r1_h: document.getElementById('br-r1-h-input').value, b_r1_m: document.getElementById('br-r1-m-input').value, b_r2_i1: document.getElementById('br-r2-i1-input').value, b_r2_i2: document.getElementById('br-r2-i2-input').value, b_r2_i3: document.getElementById('br-r2-i3-input').value, b_r2_i4: document.getElementById('br-r2-i4-input').value, b_r3_h: document.getElementById('br-r3-h-input').value, b_r3_m: document.getElementById('br-r3-m-input').value, } };
            database.ref('saved_shots').push(shotData);
            shotNameInput.value = '';
        });

        function renderShots(shots) {
            shotsList.innerHTML = '';
            for (const key in shots) {
                const shot = shots[key];
                const li = document.createElement('li');
                li.className = 'shot-item';
                li.innerHTML = `<span class="shot-name">${shot.name}</span><div class="shot-actions"><button class="btn-load">èª­è¾¼</button><button class="btn-delete">å‰Šé™¤</button></div>`;
                li.querySelector('.btn-load').addEventListener('click', () => {
                    const content = shot.content;
                    document.getElementById('br-r1-h-input').value = content.b_r1_h;
                    document.getElementById('br-r1-m-input').value = content.b_r1_m;
                    document.getElementById('br-r2-i1-input').value = content.b_r2_i1;
                    document.getElementById('br-r2-i2-input').value = content.b_r2_i2;
                    document.getElementById('br-r2-i3-input').value = content.b_r2_i3;
                    document.getElementById('br-r2-i4-input').value = content.b_r2_i4;
                    document.getElementById('br-r3-h-input').value = content.b_r3_h;
                    document.getElementById('br-r3-m-input').value = content.b_r3_m;
                    tabBreaking.click(); 
                });
                li.querySelector('.btn-delete').addEventListener('click', () => {
                    if (confirm(`ã€Œ${shot.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                        database.ref('saved_shots/' + key).remove();
                    }
                });
                shotsList.appendChild(li);
            }
        }
        database.ref('saved_shots').on('value', (snapshot) => { renderShots(snapshot.val()); });
    </script>
</body>
</html>