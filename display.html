<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1920, height=1080">
    <title>OBS Telop Display Bottom</title>
    <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">
    
    <style>
        @font-face {
            font-family: 'LINE Seed JP';
            src: url('fonts/LINESeedJP_OTF_Rg.woff2') format('woff2');
            font-weight: 400;
        }
        @font-face {
            font-family: 'LINE Seed JP';
            src: url('fonts/LINESeedJP_OTF_Bd.woff2') format('woff2');
            font-weight: 700;
        }
        
        /* リセットと基本設定 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            width: 1920px;
            height: 1080px;
            overflow: hidden;
        }
        
        body {
            width: 1920px;
            height: 1080px;
            font-family: 'LINE Seed JP', sans-serif;
            background: transparent;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }

        /* メインコンテナ - 下部に固定 */
        .main-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            width: 1920px;
            padding: 0 20px 20px 20px;
            box-sizing: border-box;
        }

        @keyframes seamless-scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-15px); }
            60% { transform: translateY(-7px); }
        }

        /* ティッカーコンテナ */
        .telop-wrapper {
            width: 100%;
            opacity: 0;
            transition: opacity 0.4s ease-out;
            display: none;
        }
        
        .telop-wrapper.visible {
            opacity: 1;
            display: block;
        }

        #ticker-container {
            height: 96px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            background: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        
        #ticker-header {
            position: absolute;
            left: 0;
            top: 0;
            z-index: 10;
            width: 300px;
            height: 100%;
            color: white;
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, #ed949f, #69aef3);
            clip-path: polygon(0 0, 100% 0, 90% 100%, 0% 100%);
            font-size: 52px;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            padding-left: 30px;
            box-shadow: 5px 0 15px rgba(0,0,0,0.2);
        }
        
        #ticker-header-text {
            white-space: nowrap;
            transform-origin: left center;
        }
        
        #ticker-clock {
            position: absolute;
            right: 0;
            top: 0;
            z-index: 10;
            width: 162px;
            height: 100%;
            background: linear-gradient(45deg, #ed949f, #69aef3);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 46px;
            font-family: 'Anton', sans-serif;
            box-shadow: -5px 0 15px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        /* スクロールエリア */
        #ticker-scroll-area {
            position: absolute;
            left: 280px;
            right: 162px;
            top: 0;
            height: 100%;
            overflow: hidden;
            display: flex;
            align-items: center;
        }
        
        .ticker-content {
            display: inline-block;
            white-space: nowrap;
            font-size: 40px;
            color: #333;
            padding-right: 50px;
            animation: seamless-scroll 30s linear infinite;
        }
        
        .speed-slow .ticker-content { animation-duration: 50s; }
        .speed-normal .ticker-content { animation-duration: 30s; }
        .speed-fast .ticker-content { animation-duration: 15s; }

        /* 時計アニメーション */
        #clock-time, #clock-live {
            position: absolute;
            width: 100%;
            text-align: center;
            transition: transform 0.4s ease;
        }
        
        #clock-live {
            transform: translateX(200%);
            font-size: 55px;
            font-style: italic;
        }
        
        #ticker-clock.show-live #clock-time { transform: translateX(-200%); }
        #ticker-clock.show-live #clock-live { transform: translateX(0); }
        
        #clock-live span {
            display: inline-block;
            animation: bounce 1.5s infinite ease-in-out;
        }
        #clock-live span:nth-child(1) { animation-delay: 0.1s; }
        #clock-live span:nth-child(2) { animation-delay: 0.2s; }
        #clock-live span:nth-child(3) { animation-delay: 0.3s; }
        #clock-live span:nth-child(4) { animation-delay: 0.4s; }
        
        /* 速報コンテナ */
        #breaking-container {
            width: 100%;
        }
        
        #breaking-container-inner {
            background: #e0e0e0;
            border-radius: 8px;
            border-left: 8px solid #c00000;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .breaking-row {
            display: flex;
            font-weight: bold;
        }
        
        .br-row1-header {
            background: #e0e0e0;
            color: #000;
            font-size: 48px;
            padding: 10px 30px;
            white-space: nowrap;
        }
        
        .br-row1-main {
            background: #c00000;
            color: white;
            font-size: 48px;
            padding: 10px 30px;
            flex: 1;
            text-align: center;
        }
        
        .br-row2 {
            background: #222;
            color: white;
            font-size: 42px;
            padding: 8px 0;
            display: flex;
        }
        
        .br-row2-item {
            flex: 1;
            text-align: center;
            padding: 0 10px;
        }
        
        .br-row2-item + .br-row2-item {
            border-left: 2px solid #555;
        }
        
        .br-row2-item-value {
            background: white;
            color: #000;
            padding: 0 15px;
            margin: 0 10px;
            border-radius: 4px;
            display: inline-block;
        }
        
        .br-row3-header {
            background: #757575;
            color: white;
            font-size: 42px;
            padding: 8px 30px;
            white-space: nowrap;
        }
        
        .br-row3-main {
            background: #e0e0e0;
            color: #000;
            font-size: 42px;
            padding: 8px 30px;
            flex: 1;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div id="ticker-container" class="telop-wrapper">
            <div id="ticker-scroll-area">
                <span id="ticker-content" class="ticker-content"></span>
            </div>
            <div id="ticker-header">
                <span id="ticker-header-text"></span>
            </div>
            <div id="ticker-clock">
                <span id="clock-time"></span>
                <span id="clock-live">
                    <span>L</span><span>I</span><span>V</span><span>E</span>
                </span>
            </div>
        </div>
        
        <div id="breaking-container" class="telop-wrapper">
            <div id="breaking-container-inner">
                <div class="breaking-row">
                    <div class="br-row1-header" id="br-row1-header"></div>
                    <div class="br-row1-main" id="br-row1-main"></div>
                </div>
                <div class="breaking-row br-row2">
                    <div class="br-row2-item" id="br-row2-item1"></div>
                    <div class="br-row2-item" id="br-row2-item2"></div>
                    <div class="br-row2-item" id="br-row2-item3"></div>
                    <div class="br-row2-item" id="br-row2-item4"></div>
                </div>
                <div class="breaking-row">
                    <div class="br-row3-header" id="br-row3-header"></div>
                    <div class="br-row3-main" id="br-row3-main"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAhsAbTqQuairo-82A9rxQTazUCGdzdVc4",
            authDomain: "obs-telop-system-7c98c.firebaseapp.com",
            databaseURL: "https://obs-telop-system-7c98c-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "obs-telop-system-7c98c",
            storageBucket: "obs-telop-system-7c98c.appspot.com",
            messagingSenderId: "368503557333",
            appId: "1:368503557333:web:409dae2b1cf0c14b31a65c",
            measurementId: "G-VMBCJ2952Z"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        let currentScrollText = "";

        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('clock-time').textContent = `${hours}:${minutes}`;
            
            const tickerClock = document.getElementById('ticker-clock');
            if (now.getSeconds() >= 30) {
                tickerClock.classList.add('show-live');
            } else {
                tickerClock.classList.remove('show-live');
            }
        }
        
        setInterval(updateClock, 1000);
        updateClock();

        function adjustHeaderText() {
            const headerText = document.getElementById('ticker-header-text');
            const header = document.getElementById('ticker-header');
            headerText.style.transform = 'scaleX(1)';
            
            const maxWidth = header.clientWidth - 60;
            const textWidth = headerText.scrollWidth;
            
            if (textWidth > maxWidth) {
                const scale = maxWidth / textWidth;
                headerText.style.transform = `scaleX(${scale})`;
            }
        }

        database.ref('live_data').on('value', (snapshot) => {
            const data = snapshot.val();
            if (!data) return;

            const tickerContainer = document.getElementById('ticker-container');
            const breakingContainer = document.getElementById('breaking-container');

            if (data.mode === 'breaking' && data.breaking_content) {
                const content = data.breaking_content;
                document.getElementById('br-row1-header').innerText = content.b_r1_h || '';
                document.getElementById('br-row1-main').innerText = content.b_r1_m || '';
                document.getElementById('br-row2-item1').innerHTML = content.b_r2_i1 || '';
                document.getElementById('br-row2-item2').innerHTML = content.b_r2_i2 || '';
                document.getElementById('br-row2-item3').innerHTML = content.b_r2_i3 || '';
                document.getElementById('br-row2-item4').innerHTML = content.b_r2_i4 || '';
                document.getElementById('br-row3-header').innerText = content.b_r3_h || '';
                document.getElementById('br-row3-main').innerText = content.b_r3_m || '';

                tickerContainer.classList.remove('visible');
                breakingContainer.classList.add('visible');
            } else {
                const content = data.ticker_content || {};
                const newScrollText = content.scrollText || 'コメントをお待ちしています。';

                if (newScrollText !== currentScrollText) {
                    currentScrollText = newScrollText;
                    const tickerContent = document.getElementById('ticker-content');
                    tickerContent.innerText = `${currentScrollText}　　　${currentScrollText}　　　`;
                }
                
                document.getElementById('ticker-header-text').innerText = 
                    content.headerText || '東京株式市場';

                const scrollArea = document.getElementById('ticker-scroll-area');
                scrollArea.className = '';
                scrollArea.classList.add(content.scrollSpeed || 'speed-normal');
                
                breakingContainer.classList.remove('visible');
                tickerContainer.classList.add('visible');
                
                setTimeout(adjustHeaderText, 100);
            }
        });
    </script>
</body>
</html>