<!-- display.html (更新後) -->
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>OBS Telop Display</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="telop-container" class="telop-container">
        <div class="bottom-bar">
            <div id="telop-header" class="bottom-bar-header"></div>
            <!-- ▼▼▼ contentにIDを追加し、中にticker-textを配置 ▼▼▼ -->
            <div id="telop-content" class="bottom-bar-content">
                <div id="telop-ticker" class="ticker-text"></div>
            </div>
            <!-- ▲▲▲ ここまで ▲▲▲ -->
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        // ▼▼▼ あなたのFirebase設定 ▼▼▼
      const firebaseConfig = {
  apiKey: "AIzaSyAhsAbTqQuairo-82A9rxQTazUCGdzdVc4",
  authDomain: "obs-telop-system-7c98c.firebaseapp.com",
  databaseURL: "https://obs-telop-system-7c98c-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "obs-telop-system-7c98c",
  storageBucket: "obs-telop-system-7c98c.firebasestorage.app",
  messagingSenderId: "368503557333",
  appId: "1:368503557333:web:409dae2b1cf0c14b31a65c",
  measurementId: "G-VMBCJ2952Z"
};
        // ▲▲▲ ここまで ▲▲▲

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // 要素を取得
        const container = document.getElementById('telop-container');
        const telopHeader = document.getElementById('telop-header');
        const telopContent = document.getElementById('telop-content');
        const telopTicker = document.getElementById('telop-ticker');

        // --- 追加: 長体処理の関数 ---
        function adjustTextScaling() {
            // 一旦スケールをリセットして正しい幅を計算
            telopTicker.style.transform = 'scaleX(1)';
            
            const containerWidth = telopContent.clientWidth;
            const textWidth = telopTicker.scrollWidth;

            // テキストがコンテナより大きい場合のみ長体をかける
            if (textWidth > containerWidth) {
                const scale = containerWidth / textWidth;
                telopTicker.style.transform = `scaleX(${scale})`;
            }
        }

        database.ref('telop').on('value', (snapshot) => {
            const data = snapshot.val();

            if (data && data.visible) {
                // ヘッダーテキストと色を更新
                telopHeader.innerText = data.header || '';
                container.className = 'telop-container'; // クラスをリセット
                container.classList.add(data.headerColor); // 例: 'header-red'

                // コンテンツの色を更新
                telopContent.className = 'bottom-bar-content'; // クラスをリセット
                telopContent.classList.add(data.contentColor); // 例: 'content-lightgray'

                // テキストを結合して表示
                const combinedText = `${data.text1 || ''}　${data.text2 || ''}　${data.text3 || ''}`;
                telopTicker.innerText = combinedText;

                // 表示クラスを追加
                container.classList.add('visible');

                // 表示後に長体処理を実行 (表示されないと正しい幅が取れないため)
                setTimeout(adjustTextScaling, 50); // 少し遅延させて実行

            } else {
                container.classList.remove('visible');
            }
        });
    </script>
</body>
</html>