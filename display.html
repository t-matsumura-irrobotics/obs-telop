<!-- display.html (更新後) -->
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>OBS Telop Display</title>
    <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="main-container">
        <div id="ticker-container" class="telop-wrapper">
            <div id="ticker-scroll-area">
                <span id="ticker-content" class="ticker-content"></span>
            </div>
            <div id="ticker-header">
                <span id="ticker-header-text"></span>
            </div>
            <div id="ticker-clock">
                <span id="clock-time"></span>
                <span id="clock-live"><span>L</span><span>I</span><span>V</span><span>E</span></span>
            </div>
        </div>
        
        <div id="breaking-container" class="telop-wrapper">
            <div id="breaking-container-inner">
                <div class="breaking-row">
                    <div class="br-row1-header" id="br-row1-header"></div>
                    <div class="br-row1-main" id="br-row1-main"></div>
                </div>
                <div class="breaking-row br-row2">
                    <div class="br-row2-item" id="br-row2-item1"></div>
                    <div class="br-row2-item" id="br-row2-item2"></div>
                    <div class="br-row2-item" id="br-row2-item3"></div>
                    <div class="br-row2-item" id="br-row2-item4"></div>
                </div>
                <div class="breaking-row">
                    <div class="br-row3-header" id="br-row3-header"></div>
                    <div class="br-row3-main" id="br-row3-main"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        const firebaseConfig = { apiKey: "AIzaSyAhsAbTqQuairo-82A9rxQTazUCGdzdVc4", authDomain: "obs-telop-system-7c98c.firebaseapp.com", databaseURL: "https://obs-telop-system-7c98c-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "obs-telop-system-7c98c", storageBucket: "obs-telop-system-7c98c.appspot.com", messagingSenderId: "368503557333", appId: "1:368503557333:web:409dae2b1cf0c14b31a65c", measurementId: "G-VMBCJ2952Z" };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        let currentScrollText = "";

        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('clock-time').textContent = `${hours}:${minutes}`;
            const tickerClock = document.getElementById('ticker-clock');
            if (now.getSeconds() >= 30) {
                tickerClock.classList.add('show-live');
            } else {
                tickerClock.classList.remove('show-live');
            }
        }
        setInterval(updateClock, 1000); updateClock();

        function adjustHeaderText() {
            const headerText = document.getElementById('ticker-header-text');
            const header = document.getElementById('ticker-header');
            headerText.style.transform = 'scaleX(1)';
            const maxWidth = header.clientWidth - 30; // 狭めた余白を考慮
            const textWidth = headerText.scrollWidth;
            if (textWidth > maxWidth) {
                headerText.style.transform = `scaleX(${maxWidth / textWidth})`;
            }
        }

        database.ref('live_data').on('value', (snapshot) => {
            const data = snapshot.val();
            if (!data) return;

            const tickerContainer = document.getElementById('ticker-container');
            const breakingContainer = document.getElementById('breaking-container');

            if (data.mode === 'breaking' && data.breaking_content) {
                const content = data.breaking_content;
                document.getElementById('br-row1-header').innerText = content.b_r1_h || '';
                document.getElementById('br-row1-main').innerText = content.b_r1_m || '';
                document.getElementById('br-row2-item1').innerHTML = content.b_r2_i1 || '';
                document.getElementById('br-row2-item2').innerHTML = content.b_r2_i2 || '';
                document.getElementById('br-row2-item3').innerHTML = content.b_r2_i3 || '';
                document.getElementById('br-row2-item4').innerHTML = content.b_r2_i4 || '';
                document.getElementById('br-row3-header').innerText = content.b_r3_h || '';
                document.getElementById('br-row3-main').innerText = content.b_r3_m || '';

                tickerContainer.classList.remove('visible');
                breakingContainer.classList.add('visible');
            } else {
                const content = data.ticker_content || {};
                const newScrollText = content.scrollText || 'コメントをお待ちしています。';
                if (newScrollText !== currentScrollText) {
                    currentScrollText = newScrollText;
                    document.getElementById('ticker-content').innerText = `${currentScrollText}　　　`;
                }
                
                document.getElementById('ticker-header-text').innerText = content.headerText || '東京株式市場';
                
                breakingContainer.classList.remove('visible');
                tickerContainer.classList.add('visible');
                
                setTimeout(adjustHeaderText, 100);
            }
        });
    </script>
</body>
</html>